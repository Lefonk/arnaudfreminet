document.addEventListener("DOMContentLoaded",()=>{let a=document.querySelectorAll(".tpgb-social-reviews");a&&a.forEach(a=>{var b={ScrollOn:a.getAttribute("data-scroll-normal"),TextLimit:a.getAttribute("data-textlimit")},c=a.getAttribute("data-textlimit");if(c=c?JSON.parse(c):"","true"==b.ScrollOn&&"false"==b.TextLimit){var d=a.querySelectorAll(".showtext");d&&d.forEach(function(a){a.clientHeight>=b.Height&&(a.classList.add(b.className),a.style.height=b.Height)})}document.addEventListener("click",function(a){if(a.target.matches(".readbtn")){let g=a.target;var b=g.closest(".tpgb-message"),d=b.closest(".tpgb-isotope .post-loop-inner"),e=g.closest(".tpgb-social-reviews").dataset.scrollNormal;e=e?JSON.parse(e):"";var f=b.querySelector(".showtext");b.classList.contains("show-text")?(b.classList.remove("show-text","show-less"),g.innerHTML=c.showmoretxt,b.querySelector(".sf-dots").style.display="inline",e&&e.ScrollOn&&e.TextLimit&&(f.classList.remove(e.className),f.removeAttribute("style"))):(b.classList.add("show-text","show-less"),g.innerHTML=c.showlesstxt,b.querySelector(".sf-dots").style.display="none",e&&e.ScrollOn&&e.TextLimit&&f.clientHeight>=e.Height&&(f.classList.add(e.className),f.style.height=e.Height+"px")),d&&new Isotope(d,{itemSelector:".grid-item",resizable:!0,sortBy:"original-order"})}});let e=a.querySelector(".review-load-more");e&&e.addEventListener("click",function(b){b.preventDefault();var c=b.currentTarget,d=c.getAttribute("data-loadattr"),e=c.getAttribute("data-display"),f=c.getAttribute("data-loadview"),g=c.getAttribute("data-loadclass"),h=c.getAttribute("data-layout"),i=c.getAttribute("data-loadingtxt"),j=c.textContent;if(!c.getAttribute("data-requestRunning")){c.setAttribute("data-requestRunning",!0),c.textContent=i;var k=new FormData;k.append("action","tpgb_reviews_load"),k.append("view",e),k.append("loadFview",f),k.append("loadattr",d),fetch(tpgb_load.ajaxUrl,{method:"POST",body:k}).then(function(a){if(!a.ok)throw new Error("Network response was not ok");return a.json()}).then(function(b){var d=b&&b.HTMLContent?b.HTMLContent:"",i=b&&b.TotalReview?b.TotalReview:"",k=b&&b.FilterStyle?b.FilterStyle:"",l=b&&b.allposttext?b.allposttext:"";if(""==b)c.classList.add("hide");else{var m=".tpgb-block-"+g,n=document.querySelector(m+" .all .tpgb-category-count"),o=document.querySelector(m+" .post-loop-inner");o&&o.insertAdjacentHTML("beforeend",d);var p=document.querySelector(m).querySelectorAll(".grid-item").length;if(n&&(n.innerHTML=p),"style-2"==k||"style-3"==k){var q=document.querySelectorAll(m+" .tpgb-filter-list .tpgb-category-list:not(.all)");q&&q.forEach(function(a){var b=a.querySelector("span:nth-child(2)").dataset.hover,c=document.querySelector(m).querySelectorAll(".grid-item."+b).length;a.querySelector("span:nth-child(1).tpgb-category-count").innerHTML=c})}("grid"==h||"masonry"==h)&&a.classList.contains("tpgb-isotope")&&jQuery(o).isotope("layout").isotope("reloadItems"),p>=+i?(c.classList.add("hide"),c.parentNode.insertAdjacentHTML("beforeend","<div class=\"tpgb-review-loaded\">"+l+"</div>")):c.textContent=j}e=+e+ +f,c.setAttribute("data-display",e)}).catch(function(a){console.log("Error:",a)}).finally(function(){c.removeAttribute("data-requestRunning")}).then(function(){if(document.querySelector(".tpgb-block-"+g).classList.contains("tpgb-isotope")&&("grid"==h||"masonry"==h)){var b=a.querySelector(".post-loop-inner");b&&jQuery(b).isotope({itemSelector:".grid-item",resizable:!0,sortBy:"original-order"})}})}});let f=a.querySelector(".tpgb-review-lazy-load");if(f&&a.classList.contains("tpgb-isotope")){var g,h,i,j,k,l,m=window,n=function(){g=m.innerWidth,h=m.innerHeight,i=document.querySelector("body").offsetHeight,k=a.offsetHeight,l=a.offsetTop+50,setTimeout(function(){k=a.offsetHeight,l=a.offsetTop+50},50)};n(),m.addEventListener("resize",n),m.addEventListener("scroll",function(b){if(b.preventDefault(),n(),j=m.pageYOffset,k=a.offsetHeight,l=a.offsetTop+50,a.querySelector(".tpgb-review-lazy-load")&&j<i&&j+60>k+l-h){let a=f.querySelector(".review-lazy-load"),b=a.dataset.lazyattr,c=a.getAttribute("data-totalreviews"),d=a.getAttribute("data-display"),e=a.dataset.lazyview,g=a.dataset.lazyclass,h=a.dataset.lazylayout,i=a.innerHTML,j=a.closest(".tpgb-block-"+g);if(a.dataset.requestRunning&&"true"==a.dataset.requestRunning)return;+c>=+d&&(a.dataset.requestRunning="true",fetch(tpgb_load.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=tpgb_reviews_load&view="+d+"&loadFview="+e+"&loadattr="+b}).then(function(a){return a.json()}).then(function(b){var c=b&&b.HTMLContent?b.HTMLContent:"",f=b&&b.TotalReview?b.TotalReview:"",g=b&&b.FilterStyle?b.FilterStyle:"",k=b&&b.allposttext?b.allposttext:"";if(""===b)a.classList.add("hide");else{var l=j.querySelector(".all .tpgb-category-count"),m=j.querySelector(".post-loop-inner");m.insertAdjacentHTML("beforeend",c);var n=j.querySelectorAll(".grid-item").length;if(l&&(l.innerHTML="",l.appendChild(document.createTextNode(n))),"style-2"===g||"style-3"===g){var o=j.querySelectorAll(".tpgb-filter-list .tpgb-category-list:not(.all)");o&&o.forEach(function(a){var b=a.querySelector("span:nth-child(2)").dataset.hover,c=j.querySelectorAll(".grid-item."+b).length;a.querySelector("span:nth-child(1).tpgb-category-count").innerHTML="",a.querySelector("span:nth-child(1).tpgb-category-count").appendChild(document.createTextNode(c))})}if(("grid"===h||"masonry"===h)&&j.classList.contains("tpgb-isotope")&&jQuery(m).isotope("layout").isotope("reloadItems"),!(n>=+f))a.innerHTML=i;else if(!a.nextElementSibling||!a.nextElementSibling.classList.contains("tpgb-review-loaded")){a.classList.add("hide");var p=document.createElement("div");p.classList.add("tpgb-review-loaded"),p.innerHTML=k,a.parentNode.appendChild(p)}}d=+d+ +e,a.setAttribute("data-display",d)}).catch(function(a){console.log("Error:",a)}).finally(function(){a.dataset.requestRunning="false"}).then(function(){if(j.classList.contains("tpgb-isotope")){if("grid"===h||"masonry"===h){var a=j.querySelector(" .post-loop-inner");setTimeout(()=>{jQuery(a).isotope({itemSelector:".grid-item",resizable:!0,sortBy:"original-order"})},100)}var b=j.querySelectorAll(".tpgb-carousel:not(.is-initialized)");b.forEach(function(a){"function"==typeof splide_init&&splide_init(a)})}}))}})}var o=a.querySelector(".batch-btn-no");o&&o.addEventListener("click",function(a){a.preventDefault();var b=this.closest(".tpgb-batch-recommend");b.style.display="none"===b.style.display?"block":"none"})})});